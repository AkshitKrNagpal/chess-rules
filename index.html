<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link href='https://fonts.googleapis.com/css?family=Chivo:900' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-dark.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <title>Chess-rules by ChessCorp</title>
  </head>

  <body>
    <div id="container">
      <div class="inner">

        <header>
          <h1>Chess-rules</h1>
          <h2>Chess Rules implementation as a standalone JavaScript module.</h2>
        </header>

        <section id="downloads" class="clearfix">
          <a href="https://github.com/ChessCorp/chess-rules/zipball/master" id="download-zip" class="button"><span>Download .zip</span></a>
          <a href="https://github.com/ChessCorp/chess-rules/tarball/master" id="download-tar-gz" class="button"><span>Download .tar.gz</span></a>
          <a href="https://github.com/ChessCorp/chess-rules" id="view-on-github" class="button"><span>View on GitHub</span></a>
        </section>

        <hr>

        <section id="main_content">
          <p><a href="https://npmjs.org/package/chess-rules"><img src="https://badge.fury.io/js/chess-rules.svg" alt="NPM version"></a> <a href="https://travis-ci.org/ChessCorp/chess-rules"><img src="https://travis-ci.org/ChessCorp/chess-rules.svg?branch=master" alt="Build Status"></a> <a href="https://david-dm.org/ChessCorp/chess-rules"><img src="https://david-dm.org/ChessCorp/chess-rules.svg?theme=shields.io" alt="Dependency Status"></a> <a href="https://coveralls.io/github/ChessCorp/chess-rules?branch=master"><img src="https://coveralls.io/repos/ChessCorp/chess-rules/badge.svg?branch=master&amp;service=github" alt="Coverage Status"></a></p>

<p>Chess Rules implementation as a standalone module.</p>

<h1>
<a id="install" class="anchor" href="#install" aria-hidden="true"><span class="octicon octicon-link"></span></a>Install</h1>

<h2>
<a id="as-a-node-module" class="anchor" href="#as-a-node-module" aria-hidden="true"><span class="octicon octicon-link"></span></a>As a Node module</h2>

<div class="highlight highlight-sh"><pre>$ npm install chess-rules</pre></div>

<p>This will install rules module in the node_modules folder.</p>

<h2>
<a id="using-bower" class="anchor" href="#using-bower" aria-hidden="true"><span class="octicon octicon-link"></span></a>Using Bower</h2>

<div class="highlight highlight-sh"><pre>$ bower install chess-rules
bower chess-rules#<span class="pl-k">*</span>             cached git://github.com/ChessCorp/chess-rules.git#0.8.0
bower chess-rules#<span class="pl-k">*</span>           validate 0.8.0 against git://github.com/ChessCorp/chess-rules.git#<span class="pl-k">*</span>
bower chess-rules#<span class="pl-k">*</span>                new version <span class="pl-k">for</span> <span class="pl-smi">git://github.com/ChessCorp/chess-rules.git</span>#<span class="pl-k">*</span>
bower chess-rules#<span class="pl-k">*</span>            resolve git://github.com/ChessCorp/chess-rules.git#<span class="pl-k">*</span>
bower chess-rules#<span class="pl-k">*</span>           download https://github.com/ChessCorp/chess-rules/archive/0.10.1.tar.gz
bower chess-rules#<span class="pl-k">*</span>            extract archive.tar.gz
bower chess-rules#<span class="pl-k">*</span>           resolved git://github.com/ChessCorp/chess-rules.git#0.10.1
bower chess-rules#~0.10.1      install chess-rules#0.10.1

chess-rules#0.10.1 bower_components/chess-rules</pre></div>

<h1>
<a id="usage" class="anchor" href="#usage" aria-hidden="true"><span class="octicon octicon-link"></span></a>Usage</h1>

<h2>
<a id="import-the-main-rules-object" class="anchor" href="#import-the-main-rules-object" aria-hidden="true"><span class="octicon octicon-link"></span></a>Import the main rules object</h2>

<div class="highlight highlight-js"><pre><span class="pl-k">&gt;</span> <span class="pl-k">var</span> chessRules <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>chess-rules<span class="pl-pds">'</span></span>);

<span class="pl-k">&gt;</span> chessRules
{ getInitialPosition<span class="pl-k">:</span> [<span class="pl-c1">Function</span><span class="pl-k">:</span> getInitialPosition],
  positionToString<span class="pl-k">:</span> [<span class="pl-c1">Function</span><span class="pl-k">:</span> positionToString],
  getAvailableMoves<span class="pl-k">:</span> [<span class="pl-c1">Function</span><span class="pl-k">:</span> getAvailableMoves],
  applyMove<span class="pl-k">:</span> [<span class="pl-c1">Function</span><span class="pl-k">:</span> applyMove],
  computeDiffs<span class="pl-k">:</span> [<span class="pl-c1">Function</span><span class="pl-k">:</span> computeDiffs],
  applyDiffs<span class="pl-k">:</span> [<span class="pl-c1">Function</span><span class="pl-k">:</span> applyDiffs],
  pgnToMove<span class="pl-k">:</span> [<span class="pl-c1">Function</span><span class="pl-k">:</span> pgnToMove],
  moveToPgn<span class="pl-k">:</span> [<span class="pl-c1">Function</span><span class="pl-k">:</span> moveToPgn],
  getGameStatus<span class="pl-k">:</span> [<span class="pl-c1">Function</span><span class="pl-k">:</span> getGameStatus] 
  }</pre></div>

<h2>
<a id="instantiate-an-initial-position-model" class="anchor" href="#instantiate-an-initial-position-model" aria-hidden="true"><span class="octicon octicon-link"></span></a>Instantiate an initial position model</h2>

<div class="highlight highlight-js"><pre><span class="pl-k">var</span> position <span class="pl-k">=</span> chessRules.<span class="pl-c1">getInitialPosition</span>();</pre></div>

<p>The position model used by the internal engine has the following structure:</p>

<div class="highlight highlight-js"><pre>{ turn<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>W<span class="pl-pds">'</span></span>,
  castlingFlags<span class="pl-k">:</span> { W<span class="pl-k">:</span> { K<span class="pl-k">:</span> <span class="pl-c1">true</span>, Q<span class="pl-k">:</span> <span class="pl-c1">true</span> }, B<span class="pl-k">:</span> { K<span class="pl-k">:</span> <span class="pl-c1">true</span>, Q<span class="pl-k">:</span> <span class="pl-c1">true</span> } },
  lastPawnMoveColumn<span class="pl-k">:</span> <span class="pl-c1">null</span>,
  check<span class="pl-k">:</span> <span class="pl-c1">false</span>,
  board<span class="pl-k">:</span> 
   [ { type<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>R<span class="pl-pds">'</span></span>, side<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>W<span class="pl-pds">'</span></span> },
     { type<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>N<span class="pl-pds">'</span></span>, side<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>W<span class="pl-pds">'</span></span> },
     { type<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>B<span class="pl-pds">'</span></span>, side<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>W<span class="pl-pds">'</span></span> },
     { type<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>Q<span class="pl-pds">'</span></span>, side<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>W<span class="pl-pds">'</span></span> },
     { type<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>K<span class="pl-pds">'</span></span>, side<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>W<span class="pl-pds">'</span></span> },
     { type<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>B<span class="pl-pds">'</span></span>, side<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>W<span class="pl-pds">'</span></span> },
     { type<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>N<span class="pl-pds">'</span></span>, side<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>W<span class="pl-pds">'</span></span> },
     { type<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>R<span class="pl-pds">'</span></span>, side<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>W<span class="pl-pds">'</span></span> },
     { type<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>P<span class="pl-pds">'</span></span>, side<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>W<span class="pl-pds">'</span></span> },
     { type<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>P<span class="pl-pds">'</span></span>, side<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>W<span class="pl-pds">'</span></span> },
     { type<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>P<span class="pl-pds">'</span></span>, side<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>W<span class="pl-pds">'</span></span> },
     { type<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>P<span class="pl-pds">'</span></span>, side<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>W<span class="pl-pds">'</span></span> },
     { type<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>P<span class="pl-pds">'</span></span>, side<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>W<span class="pl-pds">'</span></span> },
     { type<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>P<span class="pl-pds">'</span></span>, side<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>W<span class="pl-pds">'</span></span> },
     { type<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>P<span class="pl-pds">'</span></span>, side<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>W<span class="pl-pds">'</span></span> },
     { type<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>P<span class="pl-pds">'</span></span>, side<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>W<span class="pl-pds">'</span></span> },
     <span class="pl-c1">null</span>,
     <span class="pl-c1">null</span>,
     <span class="pl-c1">null</span>,
     ...
   ]
}</pre></div>

<p>The position can be logged more conveniently using the provided function positionToString:</p>

<div class="highlight highlight-js"><pre><span class="pl-k">&gt;</span> <span class="pl-en">console</span><span class="pl-c1">.log</span>(chessRules.<span class="pl-c1">positionToString</span>(position))
<span class="pl-c1">WHITE</span> KQkq
<span class="pl-c1">8</span> r n b q k b n r 
<span class="pl-c1">7</span> p p p p p p p p 
<span class="pl-c1">6</span> . . . . . . . . 
<span class="pl-c1">5</span> . . . . . . . . 
<span class="pl-c1">4</span> . . . . . . . . 
<span class="pl-c1">3</span> . . . . . . . . 
<span class="pl-c1">2</span> P P P P P P P P 
<span class="pl-c1">1</span> R N B Q K B N R 
  a b c d e f g h  </pre></div>

<p>An extra parameter can be provided to use extended charsets but may not be supported by all terminals:</p>

<div class="highlight highlight-js"><pre><span class="pl-k">&gt;</span> <span class="pl-en">console</span><span class="pl-c1">.log</span>(chessRules.<span class="pl-c1">positionToString</span>(position, <span class="pl-c1">true</span>))
<span class="pl-c1">WHITE</span> KQkq
<span class="pl-c1">8</span> ♜ ♞ ♝ ♛ ♚ ♝ ♞ ♜ 
<span class="pl-c1">7</span> ♟ ♟ ♟ ♟ ♟ ♟ ♟ ♟ 
<span class="pl-c1">6</span>                 
<span class="pl-c1">5</span>                 
<span class="pl-c1">4</span>                 
<span class="pl-c1">3</span>                 
<span class="pl-c1">2</span> ♙ ♙ ♙ ♙ ♙ ♙ ♙ ♙ 
<span class="pl-c1">1</span> ♖ ♘ ♗ ♕ ♔ ♗ ♘ ♖ 
  a b c d e f g h </pre></div>

<h2>
<a id="get-available-moves-for-a-given-position" class="anchor" href="#get-available-moves-for-a-given-position" aria-hidden="true"><span class="octicon octicon-link"></span></a>Get available moves for a given position</h2>

<p>Moves are expressed as a pair of coordinates on the board. The offset value is computed row by row starting at A1.</p>

<div class="highlight highlight-js"><pre><span class="pl-k">&gt;</span> <span class="pl-k">var</span> availableMoves <span class="pl-k">=</span> chessRules.<span class="pl-c1">getAvailableMoves</span>(position);
<span class="pl-c1">undefined</span>

<span class="pl-k">&gt;</span> availableMoves
[ { src<span class="pl-k">:</span> <span class="pl-c1">1</span>, dst<span class="pl-k">:</span> <span class="pl-c1">16</span> },
  { src<span class="pl-k">:</span> <span class="pl-c1">1</span>, dst<span class="pl-k">:</span> <span class="pl-c1">18</span> },
  { src<span class="pl-k">:</span> <span class="pl-c1">6</span>, dst<span class="pl-k">:</span> <span class="pl-c1">21</span> },
  { src<span class="pl-k">:</span> <span class="pl-c1">6</span>, dst<span class="pl-k">:</span> <span class="pl-c1">23</span> },
  { src<span class="pl-k">:</span> <span class="pl-c1">8</span>, dst<span class="pl-k">:</span> <span class="pl-c1">16</span> },
  { src<span class="pl-k">:</span> <span class="pl-c1">8</span>, dst<span class="pl-k">:</span> <span class="pl-c1">24</span> },
  { src<span class="pl-k">:</span> <span class="pl-c1">9</span>, dst<span class="pl-k">:</span> <span class="pl-c1">17</span> },
  { src<span class="pl-k">:</span> <span class="pl-c1">9</span>, dst<span class="pl-k">:</span> <span class="pl-c1">25</span> },
  { src<span class="pl-k">:</span> <span class="pl-c1">10</span>, dst<span class="pl-k">:</span> <span class="pl-c1">18</span> },
  { src<span class="pl-k">:</span> <span class="pl-c1">10</span>, dst<span class="pl-k">:</span> <span class="pl-c1">26</span> },
  { src<span class="pl-k">:</span> <span class="pl-c1">11</span>, dst<span class="pl-k">:</span> <span class="pl-c1">19</span> },
  { src<span class="pl-k">:</span> <span class="pl-c1">11</span>, dst<span class="pl-k">:</span> <span class="pl-c1">27</span> },
  { src<span class="pl-k">:</span> <span class="pl-c1">12</span>, dst<span class="pl-k">:</span> <span class="pl-c1">20</span> },
  { src<span class="pl-k">:</span> <span class="pl-c1">12</span>, dst<span class="pl-k">:</span> <span class="pl-c1">28</span> },
  { src<span class="pl-k">:</span> <span class="pl-c1">13</span>, dst<span class="pl-k">:</span> <span class="pl-c1">21</span> },
  { src<span class="pl-k">:</span> <span class="pl-c1">13</span>, dst<span class="pl-k">:</span> <span class="pl-c1">29</span> },
  { src<span class="pl-k">:</span> <span class="pl-c1">14</span>, dst<span class="pl-k">:</span> <span class="pl-c1">22</span> },
  { src<span class="pl-k">:</span> <span class="pl-c1">14</span>, dst<span class="pl-k">:</span> <span class="pl-c1">30</span> },
  { src<span class="pl-k">:</span> <span class="pl-c1">15</span>, dst<span class="pl-k">:</span> <span class="pl-c1">23</span> },
  { src<span class="pl-k">:</span> <span class="pl-c1">15</span>, dst<span class="pl-k">:</span> <span class="pl-c1">31</span> } ]
<span class="pl-k">&gt;</span> </pre></div>

<h2>
<a id="converting-a-move-from--to-pgn-movetext-notation" class="anchor" href="#converting-a-move-from--to-pgn-movetext-notation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Converting a move from / to PGN movetext notation</h2>

<p>PGN move text is described here <a href="https://en.wikipedia.org/wiki/Portable_Game_Notation">https://en.wikipedia.org/wiki/Portable_Game_Notation</a></p>

<p>Converting move text to move vector:</p>

<div class="highlight highlight-js"><pre><span class="pl-k">&gt;</span> chessRules.<span class="pl-c1">pgnToMove</span>(position, <span class="pl-s"><span class="pl-pds">'</span>e4<span class="pl-pds">'</span></span>)
{ src<span class="pl-k">:</span> <span class="pl-c1">12</span>, dst<span class="pl-k">:</span> <span class="pl-c1">28</span> }

<span class="pl-k">&gt;</span> chessRules.<span class="pl-c1">pgnToMove</span>(position, <span class="pl-s"><span class="pl-pds">'</span>Pe2e4<span class="pl-pds">'</span></span>)
{ src<span class="pl-k">:</span> <span class="pl-c1">12</span>, dst<span class="pl-k">:</span> <span class="pl-c1">28</span> }

<span class="pl-k">&gt;</span> chessRules.<span class="pl-c1">pgnToMove</span>(position, <span class="pl-s"><span class="pl-pds">'</span>Nf3<span class="pl-pds">'</span></span>)
{ src<span class="pl-k">:</span> <span class="pl-c1">6</span>, dst<span class="pl-k">:</span> <span class="pl-c1">21</span> }</pre></div>

<p>Converting move vector to PGN move text:</p>

<div class="highlight highlight-js"><pre><span class="pl-k">&gt;</span> chessRules.<span class="pl-c1">moveToPgn</span>(position, { src<span class="pl-k">:</span> <span class="pl-c1">6</span>, dst<span class="pl-k">:</span> <span class="pl-c1">23</span> });
<span class="pl-s"><span class="pl-pds">'</span>Nh3<span class="pl-pds">'</span></span></pre></div>

<p>Note: the position must always be provided because the way that the moves are shortened requires access to the current piece positions to make these transforms.</p>

<h2>
<a id="update-the-position-by-playing-moves" class="anchor" href="#update-the-position-by-playing-moves" aria-hidden="true"><span class="octicon octicon-link"></span></a>Update the position by playing moves</h2>

<p>The <strong>applyMove</strong> will apply a move vector to create a new updated position structure. The original position object remains unchanged.</p>

<div class="highlight highlight-js"><pre><span class="pl-k">&gt;</span> <span class="pl-k">var</span> moveE4 <span class="pl-k">=</span> chessRules.<span class="pl-c1">pgnToMove</span>(position,<span class="pl-s"><span class="pl-pds">'</span>e4<span class="pl-pds">'</span></span>);
<span class="pl-c1">undefined</span>

<span class="pl-k">&gt;</span> <span class="pl-k">var</span> updatedPosition <span class="pl-k">=</span> chessRules.<span class="pl-c1">applyMove</span>(position, moveE4);
<span class="pl-c1">undefined</span>

<span class="pl-k">&gt;</span> <span class="pl-en">console</span><span class="pl-c1">.log</span>(chessRules.<span class="pl-c1">positionToString</span>(position))
<span class="pl-c1">WHITE</span> KQkq
<span class="pl-c1">8</span> r n b q k b n r 
<span class="pl-c1">7</span> p p p p p p p p 
<span class="pl-c1">6</span> . . . . . . . . 
<span class="pl-c1">5</span> . . . . . . . . 
<span class="pl-c1">4</span> . . . . . . . . 
<span class="pl-c1">3</span> . . . . . . . . 
<span class="pl-c1">2</span> P P P P P P P P 
<span class="pl-c1">1</span> R N B Q K B N R 
  a b c d e f g h 
<span class="pl-c1">undefined</span>

<span class="pl-k">&gt;</span> <span class="pl-en">console</span><span class="pl-c1">.log</span>(chessRules.<span class="pl-c1">positionToString</span>(updatedPosition))
<span class="pl-c1">BLACK</span> KQkq
<span class="pl-c1">8</span> r n b q k b n r 
<span class="pl-c1">7</span> p p p p p p p p 
<span class="pl-c1">6</span> . . . . . . . . 
<span class="pl-c1">5</span> . . . . . . . . 
<span class="pl-c1">4</span> . . . . P . . . 
<span class="pl-c1">3</span> . . . . . . . . 
<span class="pl-c1">2</span> P P P P . P P P 
<span class="pl-c1">1</span> R N B Q K B N R 
  a b c d e f g h 
<span class="pl-c1">undefined</span>
<span class="pl-k">&gt;</span> </pre></div>

<h2>
<a id="determine-game-status" class="anchor" href="#determine-game-status" aria-hidden="true"><span class="octicon octicon-link"></span></a>Determine game status</h2>

<p>A game status can be either:</p>

<ul>
<li>OPEN - The game is still in progress</li>
<li>PAT - The game has ended as one of the players couldn't move anymore while not being checkmate</li>
<li>WHITEWON - The white player won</li>
<li>BLACKWON - The black player won</li>
</ul>

<div class="highlight highlight-js"><pre><span class="pl-k">&gt;</span> chessRules.<span class="pl-c1">getGameStatus</span>(position)
<span class="pl-s"><span class="pl-pds">'</span>OPEN<span class="pl-pds">'</span></span></pre></div>

<h2>
<a id="license" class="anchor" href="#license" aria-hidden="true"><span class="octicon octicon-link"></span></a>License</h2>

<p>MIT © <a href="http://www.alcibiade.org/">Yannick Kirschhoffer</a></p>
        </section>

        <footer>
          Chess-rules is maintained by <a href="https://github.com/ChessCorp">ChessCorp</a><br>
          This page was generated by <a href="https://pages.github.com">GitHub Pages</a>. Tactile theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.
        </footer>

        
      </div>
    </div>
  </body>
</html>
